<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% if business_settings and business_settings.business_name %}{{ business_settings.business_name }} - POS System{% else %}POS System{% endif %}{% endblock %}</title>
    
    <!-- Tailwind CSS CDN for immediate styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Chart.js for charts and graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Alpine.js for interactivity -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        @media (min-width: 1024px) {
            .sidebar-hidden {
                transform: translateX(0);
            }
        }
        
        /* Ensure proper layout structure */
        body {
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .min-h-screen {
            min-height: 100vh;
        }
        
        /* Main content area positioning */
        .lg\:ml-64 {
            margin-left: 16rem; /* 256px - matches sidebar width */
        }
        
        /* Footer positioning fixes */
        footer {
            position: relative;
            z-index: 20;
            margin-top: auto;
        }
        
        /* Ensure main content area doesn't overlap footer */
        main {
            min-height: calc(100vh - 300px);
            flex: 1;
        }
        
        /* Fix for desktop layout */
        @media (min-width: 1024px) {
            .lg\:ml-64 {
                margin-left: 16rem;
            }
            
            footer {
                position: relative;
                z-index: 20;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div x-data="{ sidebarOpen: window.innerWidth >= 1024 }" class="min-h-screen">
        <!-- Sidebar -->
        <div class="fixed inset-y-0 left-0 z-50 w-64 bg-gray-800 sidebar-transition" 
             :class="{ 'sidebar-hidden': !sidebarOpen && window.innerWidth < 1024 }">
            <div class="flex items-center justify-between h-16 px-6 bg-gray-900">
                <div class="flex-1 min-w-0">
                    <h1 class="text-lg font-bold text-white leading-tight">
                        {% if business_settings and business_settings.business_name %}
                            <span class="block">{{ business_settings.business_name }}</span>
                            <span class="block text-sm text-gray-300">POS SYSTEM</span>
                        {% else %}
                            POS SYSTEM
                        {% endif %}
                    </h1>
                </div>
                <button @click="sidebarOpen = false" class="text-gray-400 hover:text-white lg:hidden ml-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <nav class="px-4 py-6">
                <div class="space-y-2">
                    <a href="{{ url_for('admin.dashboard') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        Dashboard
                    </a>
                    
                    <a href="{{ url_for('sales.pos') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-cash-register mr-3"></i>
                        POS
                    </a>
                    
                    <a href="{{ url_for('inventory.products') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-box mr-3"></i>
                        Products
                    </a>
                    
                    <a href="{{ url_for('inventory.suppliers') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-truck mr-3"></i>
                        Suppliers
                    </a>
                    
                    <a href="{{ url_for('customers.customers') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-user-friends mr-3"></i>
                        Customers
                    </a>
                    
                    <a href="{{ url_for('sales.sales_history') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-history mr-3"></i>
                        Sales History
                    </a>
                    
                    <a href="{{ url_for('reports.dashboard') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-chart-bar mr-3"></i>
                        Reports
                    </a>
                    
                    {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <a href="{{ url_for('admin.users') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-users mr-3"></i>
                        Users
                    </a>
                    
                    <a href="{{ url_for('settings.system_settings') }}" 
                       class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                        <i class="fas fa-cog mr-3"></i>
                        Settings
                    </a>
                    {% endif %}
                    
                    <div class="pt-4 mt-4 border-t border-gray-700">
                        <a href="{{ url_for('auth.logout') }}" 
                           class="flex items-center px-4 py-2 text-gray-300 rounded-lg hover:bg-gray-700 hover:text-white">
                            <i class="fas fa-sign-out-alt mr-3"></i>
                            Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="lg:ml-64 min-h-screen flex flex-col">
            <!-- Top Navigation -->
            <header class="bg-white shadow-sm border-b border-gray-200 lg:hidden">
                <div class="flex items-center justify-between px-4 py-3">
                    <button @click="sidebarOpen = true" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900">
                        {% if business_settings and business_settings.business_name %}
                            {{ business_settings.business_name }}
                        {% else %}
                            POS System
                        {% endif %}
                    </h1>
                    <div class="w-8"></div>
                </div>
            </header>

            <!-- Page Content -->
            <main class="flex-1 p-6 bg-gray-100">
                <!-- Flash messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-6 space-y-2">
                            {% for category, message in messages %}
                                <div class="p-4 rounded-lg {% if category == 'error' %}bg-red-100 text-red-700 border border-red-200{% elif category == 'success' %}bg-green-100 text-green-700 border border-green-200{% else %}bg-blue-100 text-blue-700 border border-blue-200{% endif %}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </main>

            <!-- Footer -->
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <footer class="bg-gray-800 text-white mt-auto">
                <div class="max-w-7xl mx-auto px-6 py-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Company Info -->
                        <div class="col-span-1 lg:col-span-2">
                            <h3 class="text-lg font-semibold mb-4">
                                {% if business_settings and business_settings.business_name %}
                                    {{ business_settings.business_name }}
                                {% else %}
                                    POS System
                                {% endif %}
                            </h3>
                            <p class="text-gray-300 text-sm mb-4 leading-relaxed">
                                Professional Point of Sale system designed for modern businesses. 
                                Streamline your operations with our comprehensive solution.
                            </p>
                            <div class="flex space-x-4">
                                <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                    <i class="fab fa-facebook text-xl"></i>
                                </a>
                                <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                    <i class="fab fa-twitter text-xl"></i>
                                </a>
                                <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                    <i class="fab fa-linkedin text-xl"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Quick Links -->
                        <div class="col-span-1">
                            <h4 class="text-md font-semibold mb-4">Quick Links</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="{{ url_for('admin.dashboard') }}" class="text-gray-300 hover:text-white transition-colors">Dashboard</a></li>
                                <li><a href="{{ url_for('sales.pos') }}" class="text-gray-300 hover:text-white transition-colors">POS Terminal</a></li>
                                <li><a href="{{ url_for('inventory.products') }}" class="text-gray-300 hover:text-white transition-colors">Products</a></li>
                                <li><a href="{{ url_for('customers.customers') }}" class="text-gray-300 hover:text-white transition-colors">Customers</a></li>
                            </ul>
                        </div>

                        <!-- Support -->
                        <div class="col-span-1">
                            <h4 class="text-md font-semibold mb-4">Support</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Help Center</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Contact Us</a></li>
                                <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Documentation</a></li>
                                <li><a href="#" class="text-gray-300 hover:text-white transition-colors">Training</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Bottom Footer -->
                    <div class="border-t border-gray-700 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-400">
                            <p>&copy; 2025 {% if business_settings and business_settings.business_name %}{{ business_settings.business_name }}{% else %}POS System{% endif %}. All rights reserved.</p>
                        </div>
                        <div class="flex space-x-6 mt-4 md:mt-0 text-sm">
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">Terms of Service</a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">Cookie Policy</a>
                        </div>
                    </div>
                </div>
            </footer>
            {% endif %}
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div x-show="sidebarOpen && window.innerWidth < 1024" 
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden"
         @click="sidebarOpen = false"></div>

    {% block scripts %}{% endblock %}
</body>
</html>
